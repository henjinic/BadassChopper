<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Badass Chopper Simulation</title>
  </head>

  <body onload="main()">
    <h1>Badass Chopper Simulation</h1>
    <h3>by Hyeonjin Kim (2013875008, Landscape Architecture)</h3>

    <canvas id="webgl" width="600" height="600">
      Please use a browser that supports "canvas"
    </canvas>

    <p>
      Please use arrow keys, 'w', and 's'.
    </p>

    <script id="vshader-colored" type="x-shader/x-vertex">
      attribute vec4 a_Position;
      attribute vec4 a_Color;
      attribute vec4 a_Normal;
      uniform mat4 u_MvpMatrix;
      uniform mat4 u_ModelMatrix;
      uniform mat4 u_NormalMatrix;
      varying vec3 v_Position;
      varying vec4 v_Color;
      varying vec3 v_Normal;
      void main()
      {
        gl_Position = u_MvpMatrix * a_Position;
        v_Position = vec3(u_ModelMatrix * a_Position);
        v_Color = a_Color;
        v_Normal = vec3(u_NormalMatrix * a_Normal);
      }
    </script>

    <script id="fshader-colored" type="x-shader/x-fragment">
      precision mediump float;
      varying vec3 v_Position;
      varying vec4 v_Color;
      varying vec3 v_Normal;
      void main()
      {
        vec3 normal = normalize(v_Normal);
        vec3 lightDirection = normalize(vec3(1.0, -1.0, 3.0));

        vec3 diffuse = vec3(1.0, 1.0, 1.0) * v_Color.rgb * max(dot(lightDirection, normal), 0.0);
        vec3 ambient = vec3(0.2, 0.2, 0.2) * v_Color.rgb;
        gl_FragColor = vec4(diffuse + ambient, v_Color.a);
      }
    </script>

    <script id="vshader-textured" type="x-shader/x-vertex">
      attribute vec4 a_Position;
      attribute vec2 a_TexCoord;
      uniform   mat4 u_MvpMatrix;
      varying   vec2 v_TexCoord;
      void main()
      {
        gl_Position = u_MvpMatrix * a_Position;
        v_TexCoord  = a_TexCoord;
      }
    </script>

    <script id="fshader-textured" type="x-shader/x-fragment">
      precision mediump float;
      uniform sampler2D u_Sampler;
      varying vec2 v_TexCoord;
      void main()
      {
        gl_FragColor = texture2D(u_Sampler, v_TexCoord);
      }
    </script>

    <script id="vshader-terrain" type="x-shader/x-vertex">
      attribute vec2 a_TexCoord;
      uniform mat4 u_MvpMatrix;
      uniform mat4 u_ModelMatrix;
      uniform sampler2D u_Sampler;
      varying vec3 v_Position;
      varying vec3 v_Normal;
      void main()
      {
        vec4 pos = vec4((a_TexCoord - 0.5) * 4.0, 1.0 * texture2D(u_Sampler, a_TexCoord).r, 1.0);

        gl_Position = u_MvpMatrix * pos;

        v_Position = vec3(u_ModelMatrix * pos);
        float dzds = (texture2D(u_Sampler, a_TexCoord + vec2(0.01, 0)).r - texture2D(u_Sampler, a_TexCoord - vec2(0.01, 0)).r) / 0.02;
        float dzdt = (texture2D(u_Sampler, a_TexCoord + vec2(0, 0.01)).r - texture2D(u_Sampler, a_TexCoord - vec2(0, 0.01)).r) / 0.02;
        v_Normal = cross(vec3(4.0, 0, dzds), vec3(0, 4.0, dzdt));
      }
    </script>

    <script id="fshader-terrain" type="x-shader/x-fragment">
      precision mediump float;
      varying vec3 v_Position;
      varying vec3 v_Normal;
      void main()
      {
        vec3 normal = normalize(v_Normal);
        vec3 lightDirection = normalize(vec3(1.0, -1.0, 3.0));
        vec3 diffuse = vec3(1.0, 1.0, 1.0) * vec3(0.7, 0.5, 0.3) * max(dot(lightDirection, normal), 0.0);
        vec3 ambient = vec3(0.2, 0.2, 0.2) * vec3(0.7, 0.5, 0.3);
        gl_FragColor = vec4(diffuse + ambient, 1.0);
        // gl_FragColor = vec4(0.7, 0.5, 0.3, 1.0);
      }
    </script>

    <script src="./lib/webgl-utils.js"></script>
    <script src="./lib/webgl-debug.js"></script>
    <script src="./lib/cuon-utils.js"></script>
    <script src="./lib/cuon-matrix.js"></script>
    <script src="./BadassChopperSimulation.js"></script>
    <script src="./Renderer.js"></script>
    <script src="./Component.js"></script>
    <script src="./Iterator.js"></script>
  </body>
</html>
